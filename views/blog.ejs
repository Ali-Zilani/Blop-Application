<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include('./partials/head') %>
    <title>Blog Page</title>
  </head>
  <body>
    <%- include('./partials/nav') %>
    <div class="container mt-4">
      <h1><%= blog.title %></h1>
      <img src="<%= blog.coverImageURL %>" alt="coverImage" width="400px" />
      <pre><%= blog.content %></pre>
    </div>

    <div class="container mt-4">
      <img
        src="<%= blog.createdBy.profileImageURL %>"
        alt="UserProfileImage"
        width="50px"
      />
      By <%= blog.createdBy.fullName %>
    </div>

    <% if(locals.user) { %>
    <div class="container mt-4">
      <h3>Comments</h3>
      <form action="/blog/comment/<%= blog._id %>" method="POST">
        <div class="mb-3">
          <label for="content" class="form-label">Add a comment:</label>
          <textarea
            class="form-control"
            id="content"
            name="content"
            rows="3"
            required
          ></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Submit</button>
      </form>

      <div class="mt-4">
        <% if ( comments.length > 0) { %> <% comments.forEach(function(comment)
        { %>
        <div class="card mb-2">
          <div class="card-body">
            <div class="d-flex align-items-start">
              <img
                src="<%= comment.commentedBy.profileImageURL %>"
                alt="User Profile"
                width="40px"
                height="40px"
                class="rounded-circle me-3"
              />
              <div class="flex-grow-1">
                <p class="card-text"><%= comment.content %></p>
                <footer class="blockquote-footer">
                  Commented by:
                  <strong><%= comment.commentedBy.fullName %></strong>
                  on <%= new Date(comment.createdAt).toLocaleString() %>
                </footer>
              </div>
            </div>
          </div>
        </div>
        <% }); %> <% } else { %>
        <p>No comments yet. Be the first to comment!</p>
        <% } %>
      </div>
    </div>
    <% } %> <%- include('./partials/scripts') %>
  </body>
</html>
